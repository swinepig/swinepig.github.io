<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="google-site-verification" content="6GTeiOhqimfTtuUIQtS8CqdXJzM4lPPMeXjbvNAsm5w"><meta name="baidu-site-verification" content="DAG301RZPX"><title>一个相册引发的血案 | 情流感的博格</title><link rel="stylesheet" type="text/css" href="/css/normalize.min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">一个相册引发的血案</h1><a id="logo" href="/.">情流感的博格</a><p class="description">时光的脚本总是走的太急 一个转身就把昨天变成了回忆</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/resume/"><i class="fa fa-user"> 自白</i></a><a href="/history/"><i class="fa fa-book"> 足迹</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4 single_page"><div class="content_container"><div class="post"><h1 class="post-title">一个相册引发的血案</h1><div class="post-meta">Feb 24, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>事情是这样的：本想给博客加个相册功能按照网友的方法(传送门 <a href="http://www.cnblogs.com/xljzlw/p/5137622.html" target="_blank" rel="external">http://www.cnblogs.com/xljzlw/p/5137622.html</a> )一步步的下来也相安无事，没想到一大堆坑等着我去踩！</p>
<p>在创建完<code>tool.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line">    <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line">    <span class="keyword">const</span> path = <span class="string">"../../photos"</span>;</div><div class="line"></div><div class="line">    fs.readdir(path, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">let</span> arr = [];</div><div class="line">        (<span class="function"><span class="keyword">function</span> <span class="title">iterator</span>(<span class="params">index</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (index == files.length) &#123;</div><div class="line">                fs.writeFile(<span class="string">"output.json"</span>, <span class="built_in">JSON</span>.stringify(arr, <span class="literal">null</span>, <span class="string">"\t"</span>));</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            fs.stat(path + <span class="string">"/"</span> + files[index], <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (err) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (stats.isFile()) &#123;</div><div class="line">                    arr.push(files[index]);</div><div class="line">                &#125;</div><div class="line">                iterator(index + <span class="number">1</span>);</div><div class="line">            &#125;)</div><div class="line">        &#125;(<span class="number">0</span>));</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>在运行<code>node tool.js</code>时遇到了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Use of const in strict mode</div></pre></td></tr></table></figure>
<p>一查原来<code>Node.js</code>对于<code>const</code>、<code>let</code>等关键字需要高版本本地服务器为<code>0.12.8</code>相对老了点。既然版本低那就升级呗</p>
<p>首先安装n模块：</p>
<blockquote>
<p>npm install -g n</p>
</blockquote>
<p>升级node.js到最新稳定版</p>
<blockquote>
<p>n stable</p>
</blockquote>
<p>喝完一杯咖啡版本已然升到7.6 -_-||| 果然顺利完成 <code>node tool.js</code>剩下的步骤也有惊无险的完成，幻想着可以把喜爱的照片放到自己的博客上欣赏时一个炸弹重重地打碎了我的美梦！</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ERROR Plugin load failed: hexo-renderer-sass</div><div class="line">Error: /usr/local/src/hexo/node_modules/hexo-renderer-sass/node_modules/node-sass/vendor/linux-ia32-<span class="number">46</span>/binding.node: ELF load <span class="keyword">command</span> past end of <span class="keyword">file</span></div><div class="line">    at Error (native)</div><div class="line">    at Object.Module._extensions..node (module.<span class="keyword">j</span><span class="variable">s:434</span>:<span class="number">18</span>)</div><div class="line">    at Module.load (module.<span class="keyword">j</span><span class="variable">s:343</span>:<span class="number">32</span>)</div><div class="line">    at Function.Module._load (module.<span class="keyword">j</span><span class="variable">s:300</span>:<span class="number">12</span>)</div><div class="line">    at Module.require (module.<span class="keyword">j</span><span class="variable">s:353</span>:<span class="number">17</span>)</div><div class="line">    at require (internal/module.<span class="keyword">j</span><span class="variable">s:12</span>:<span class="number">17</span>)</div><div class="line">    at Object.<span class="symbol">&lt;anonymous&gt;</span> (/usr/local/src/hexo/node_modules/hexo-renderer-sass/node_modules/node-sass/lib/<span class="built_in">index</span>.<span class="keyword">j</span><span class="variable">s:24</span>:<span class="number">15</span>)</div><div class="line">    at Module._compile (module.<span class="keyword">j</span><span class="variable">s:409</span>:<span class="number">26</span>)</div><div class="line">    at Object.Module._extensions..js (module.<span class="keyword">j</span><span class="variable">s:416</span>:<span class="number">10</span>)</div><div class="line">    at Module.load (module.<span class="keyword">j</span><span class="variable">s:343</span>:<span class="number">32</span>)</div><div class="line">    at Function.Module._load (module.<span class="keyword">j</span><span class="variable">s:300</span>:<span class="number">12</span>)</div><div class="line">    at Module.require (module.<span class="keyword">j</span><span class="variable">s:353</span>:<span class="number">17</span>)</div><div class="line">    at require (/usr/local/src/hexo/node_modules/hexo/lib/hexo/<span class="built_in">index</span>.<span class="keyword">j</span><span class="variable">s:213</span>:<span class="number">21</span>)</div><div class="line">    at /usr/local/src/hexo/node_modules/hexo-renderer-sass/<span class="built_in">index</span>.<span class="keyword">j</span><span class="variable">s:1</span>:<span class="number">79</span></div><div class="line">    at /usr/local/src/hexo/node_modules/hexo/lib/hexo/<span class="built_in">index</span>.<span class="keyword">j</span><span class="variable">s:229</span>:<span class="number">12</span></div><div class="line">    at tryCatcher (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/util.<span class="keyword">j</span><span class="variable">s:16</span>:<span class="number">23</span>)</div><div class="line">    at Promise._settlePromiseFromHandler (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:510</span>:<span class="number">31</span>)</div><div class="line">    at Promise._settlePromise (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:567</span>:<span class="number">18</span>)</div><div class="line">    at Promise._settlePromise0 (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:612</span>:<span class="number">10</span>)</div><div class="line">    at Promise._settlePromises (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:691</span>:<span class="number">18</span>)</div><div class="line">    at Promise._fulfill (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:636</span>:<span class="number">18</span>)</div><div class="line">    at Promise._resolveCallback (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:431</span>:<span class="number">57</span>)</div><div class="line">    at Promise._settlePromiseFromHandler (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:522</span>:<span class="number">17</span>)</div><div class="line">    at Promise._settlePromise (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:567</span>:<span class="number">18</span>)</div><div class="line">    at Promise._settlePromise0 (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:612</span>:<span class="number">10</span>)</div><div class="line">    at Promise._settlePromises (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:691</span>:<span class="number">18</span>)</div><div class="line">    at Promise._fulfill (/usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/promise.<span class="keyword">j</span><span class="variable">s:636</span>:<span class="number">18</span>)</div><div class="line">    at /usr/local/src/hexo/node_modules/hexo/node_modules/bluebird/js/release/nodeback.<span class="keyword">j</span><span class="variable">s:42</span>:<span class="number">21</span></div><div class="line">    at /usr/local/src/hexo/node_modules/hexo/node_modules/hexo-fs/node_modules/graceful-fs/graceful-fs.<span class="keyword">j</span><span class="variable">s:78</span>:<span class="number">16</span></div><div class="line">    at FSReqWrap.readFileAfterClose [<span class="keyword">as</span> oncomplete] (fs.<span class="keyword">j</span><span class="variable">s:380</span>:<span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>插件hexo-renderer-sass加载失败 <code>npm rebuild node-sass</code>无效后怀疑是不是因为升级node后影响了这个插件的正常工作，为了验证这个猜测决定将node版本还原到原来的版本 v0.12.8</p>
<p>node版本的管理可以使用<code>nvm</code>非常方便</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nvm install <span class="number">0.12</span>.<span class="number">8</span></div></pre></td></tr></table></figure>
<blockquote>
<p>需要将node默认版本设置为0.12.8 <code>nvm alias default 0.12.8</code>，不然新开终端版本还是原来的高版本</p>
</blockquote>
<p>版本降低后运行<code>hexo clean</code>无出错信息，但是另一个问题又出现了：我的相册呢？？？</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://swinepig.github.io/2017/02/24/hexo-node-error/" data-id="cjgd4621q00131ishxarm5xzn" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2017/02/27/linkedList/" class="pre">LinkedList数据结构小觑</a><a href="/2017/02/09/ibmj9/" class="next">IBM J9 垃圾回收小记</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4 single_page"><div id="footer">© <a href="/." rel="nofollow">情流感的博格.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"> 浙ICP备16030196号. </a><img src="/images/beian.png" class="nofancybox"/><a rel="nofollow" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602007686"> 浙公网安备 33010602007686号</a><br/><a rel="nofollow" target="_blank" href="https://portal.qiniu.com"><img src="/images/qiniu.png" class="nofancybox"/></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b623fabd5cba99249d5792f478102d0c";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>