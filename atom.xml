<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Swinepig</title>
  <subtitle>情流感的博格</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://swinepig.github.io/"/>
  <updated>2016-09-02T06:34:54.940Z</updated>
  <id>https://swinepig.github.io/</id>
  
  <author>
    <name>xin zhu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://swinepig.github.io/2016/09/02/hello-world/"/>
    <id>https://swinepig.github.io/2016/09/02/hello-world/</id>
    <published>2016-09-02T06:34:54.948Z</published>
    <updated>2016-09-02T06:34:54.940Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
      <category term="测试" scheme="https://swinepig.github.io/categories/%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="测试" scheme="https://swinepig.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>My New Post</title>
    <link href="https://swinepig.github.io/2016/09/02/My-New-Post/"/>
    <id>https://swinepig.github.io/2016/09/02/My-New-Post/</id>
    <published>2016-09-02T01:54:02.000Z</published>
    <updated>2016-09-02T06:51:25.045Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>记一次数据迁移的经历</title>
    <link href="https://swinepig.github.io/2016/08/28/db2datatransfer/"/>
    <id>https://swinepig.github.io/2016/08/28/db2datatransfer/</id>
    <published>2016-08-28T08:08:34.000Z</published>
    <updated>2016-09-02T09:22:18.363Z</updated>
    
    <content type="html"><![CDATA[<p>前段时间公司要求我们项目版本做一次回收，因需要回公司做演示还需要将服务器数据考回到本地–这步比较棘手因为客户方开发环境U盘无法使用=。=，最后好不容易找了个借口<br>向别人搞了个内部U盘。</p>
<p>我们开发环境为AIX+DB2，因为只需做演示使用数据导出觉定不采用 <code>db2move</code> 命令，只选取全部基础表+少量业务表做数据导出(使用 <code>export</code> 命令)</p>
<p>总的来说按照以下步骤进行：</p>
<ul>
<li>源数据源数据导出(export)</li>
<li>源数据库表结构等导出(db2look)</li>
<li>本地Win环境安装DB2，重建数据库(缓冲区，表空间，索引空间等)</li>
<li>本地数据结构恢复(db2 -tf db2look.sql)</li>
<li>本地数据恢复(import)</li>
</ul>
<h2 id="具体详细步骤"><a href="#具体详细步骤" class="headerlink" title="具体详细步骤"></a>具体详细步骤</h2><h3 id="源数据源数据导出"><a href="#源数据源数据导出" class="headerlink" title="源数据源数据导出"></a>源数据源数据导出</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db2 connect <span class="keyword">to</span> dbname</div><div class="line">db2 -<span class="keyword">tf</span> exportDate.sql</div></pre></td></tr></table></figure>
<p>exportData.sql中类似 <code>export to XX.del OF DEL SELECT * FROM XX</code> 语句</p>
<h3 id="源数据库表结构等导出"><a href="#源数据库表结构等导出" class="headerlink" title="源数据库表结构等导出"></a>源数据库表结构等导出</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db2look -d DBname -<span class="selector-tag">a</span> -e -<span class="selector-tag">p</span> -<span class="selector-tag">i</span> userID -w password -o db2look.sql</div></pre></td></tr></table></figure>
<h3 id="重建数据库"><a href="#重建数据库" class="headerlink" title="重建数据库"></a>重建数据库</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> DATABASE DBNAME AUTOMATIC STORAGE NO  <span class="keyword">ON</span> <span class="string">'G:\'</span> <span class="keyword">USING</span> CODESET GBK TERRITORY CN COLLATE <span class="keyword">USING</span> SYSTEM PAGESIZE <span class="number">32768</span> </div><div class="line">    </div><div class="line"><span class="keyword">CREATE</span> BUFFERPOOL CSBP1 IMMEDIATE  SIZE <span class="number">4000</span> PAGESIZE <span class="number">32</span> K </div><div class="line">   </div><div class="line"><span class="keyword">CREATE</span> REGULAR TABLESPACE CS_DATA PAGESIZE <span class="number">32</span> K MANAGED <span class="keyword">BY</span> DATABASE <span class="keyword">USING</span> ( FILE <span class="string">'G:\TBS\tablespace'</span> <span class="number">65536</span> ) EXTENTSIZE <span class="number">32</span> OVERHEAD <span class="number">10.5</span> PREFETCHSIZE <span class="number">32</span> TRANSFERRATE <span class="number">0.14</span> BUFFERPOOL  CSBP1</div><div class="line">   </div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> REGULAR TABLESPACE CS_IDX PAGESIZE <span class="number">32</span> K MANAGED <span class="keyword">BY</span> DATABASE <span class="keyword">USING</span> ( FILE <span class="string">'G:\TBS\indexspace'</span> <span class="number">1310720</span> ) EXTENTSIZE <span class="number">32</span> OVERHEAD <span class="number">10.5</span> PREFETCHSIZE <span class="number">32</span> TRANSFERRATE <span class="number">0.14</span> BUFFERPOOL  CSBP1</div><div class="line">  </div><div class="line"></div><div class="line">GRANTDBADM,CREATETAB,BINDADD,CONNECT,CREATE_NOT_FENCED_ROUTINE,IMPLICIT_SCHEMA,LOAD,CREATE_EXTERNAL_ROUTINE,QUIESCE_CONNECT,SECADM <span class="keyword">ON</span> DATABASE <span class="keyword">TO</span> USER userID</div><div class="line">   </div><div class="line"></div><div class="line">GRANT USE <span class="keyword">OF</span> TABLESPACE CS_DATA <span class="keyword">TO</span> USER ccmsdb <span class="keyword">WITH</span> GRANT OPTION</div></pre></td></tr></table></figure>
<h3 id="本地数据结构恢复"><a href="#本地数据结构恢复" class="headerlink" title="本地数据结构恢复"></a>本地数据结构恢复</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db2</span> <span class="selector-tag">-tvf</span> <span class="selector-tag">db2look</span><span class="selector-class">.sql</span></div></pre></td></tr></table></figure>
<h3 id="本地数据恢复"><a href="#本地数据恢复" class="headerlink" title="本地数据恢复"></a>本地数据恢复</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db2</span> <span class="selector-tag">-tf</span> <span class="selector-tag">importDate</span><span class="selector-class">.sql</span></div></pre></td></tr></table></figure>
<p>importDate.sql中类似 <code>import from  XX.del OF DEL replace into XX</code> 语句</p>
<blockquote>
<p><strong>Note:</strong><br>   对于主键自增长型 GENERATED ALWAYS AS IDENTIFY 和 GENERATED BY DEFAULT AS IDENTIFY 数据重新导入时为了不影响原来的自增主键需使用<br>   <code>load from XX.del of del modified by identityoverride replace into basi_role nonrecoverable</code></p>
</blockquote>
<h2 id="碰到的问题"><a href="#碰到的问题" class="headerlink" title="碰到的问题"></a>碰到的问题</h2><h3 id="问题一"><a href="#问题一" class="headerlink" title="问题一"></a>问题一</h3><p>现象：数据库安装好后，需安装应用服务器WEBLOGIC,在应用部署到WEBLOGIC上后出现 <code>org.hibernate.QueryException: ClassNotFoundException: org.hibernate.hql.ast.HqlToken</code> 异常</p>
<p>原因：Hibernate3 采用新的基于 antlr 的 HQL/SQL 查询翻译器，在 hibernate3 中需要用到 antlr，然而这个包在 weblogic 中已经包含了 antrl 类库，所以会产生一些类加载的错误，无法找到在 war 或 ear 中的 hibernate3.jar</p>
<p>解决方案：修改 %DOMAIN_HOME%/bin/setDomainEnv.cmd（Linux 为 setDomainEnv.sh），如：D:\Program\weblogic-10.3.6\mydomain\bin\setDomainEnv.cmd，在 set JAVA_HOME 的后面加上set PRE_CLASSPATH=path_of_antlr_jar</p>
<hr>
<h3 id="问题二"><a href="#问题二" class="headerlink" title="问题二"></a>问题二</h3><p>现象：不知什么原因在配置DB2数据源选择IBM DB2 TYPE4驱动时填写IP和端口时页面没有此两项输入地方，后台又提示必须输入主机和端口。</p>
<p>原因：未知，删除缓存重启WEBLOGIC也不行</p>
<p>解决方案：采用一个投机取巧的办法：先将安装DB2时安装的DB2驱动放到WEBLOGIC域下lib下面，然后在WEBLOGIC建数据源时选取ORACLE DB2驱动(选择这个无法连接数据库可能还需要原厂商的好使)，<br>然后手动修改IBM DB2的url和驱动类(com.ibm.db2.jcc.DB2Driver)</p>
<hr>
<h3 id="问题三"><a href="#问题三" class="headerlink" title="问题三"></a>问题三</h3><p>现象：应用在本地出现未知错误</p>
<p>原因：查看日志发现存在很多java.lang.OutOfMemoryError: PermGen space，内存溢出。使用jvisualvm发现持久代MaxPermSize值只有128MB</p>
<p>解决方案：%DOMAIN_HOME%/bin/setDomainEnv.cmd（Linux 为 setDomainEnv.sh）-Xms1024m -Xmx1024m -XX:PermSize=48m -XX:MaxPermSize=256m </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前段时间公司要求我们项目版本做一次回收，因需要回公司做演示还需要将服务器数据考回到本地–这步比较棘手因为客户方开发环境U盘无法使用=。=，最后好不容易找了个借口&lt;br&gt;向别人搞了个内部U盘。&lt;/p&gt;
&lt;p&gt;我们开发环境为AIX+DB2，因为只需做演示使用数据导出觉定不采用 
    
    </summary>
    
      <category term="database" scheme="https://swinepig.github.io/categories/database/"/>
    
    
      <category term="db2" scheme="https://swinepig.github.io/tags/db2/"/>
    
  </entry>
  
</feed>
